<!DOCTYPE html>
<html>
<head>
	<title>Auth0 Authentication</title>
	<script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
</head>
<body>
<button id="login">Login</button>
<button id="logout" style="display:none;">Logout</button>
<div id="user-info"></div>

<script>
	// Configure Auth0
	const auth0 = new window.auth0.Auth0Client({
		domain: 'dev-78lzqdfeprangx5i.us.auth0.com',
		clientId: '6C04vCsn6pedLfoUqylhtpCvbAtbfjvv',
		authorizationParams: {
			redirect_uri: window.location.origin
		},
		useSecureCookies: false,
		useFormData: false
	});

	// Login button handler
	document.getElementById('login').addEventListener('click', async () => {
		try {
			// Redirect to Auth0 login page
			await auth0.loginWithRedirect();
		} catch (error) {
			console.error('Login failed:', error);
		}
	});

	// Logout button handler
	document.getElementById('logout').addEventListener('click', async () => {
		try {
			await auth0.logout({
				logoutParams: {
					returnTo: window.location.origin
				}
			});
		} catch (error) {
			console.error('Logout failed:', error);
		}
	});

	// Handle authentication state
	async function handleAuthState() {
		try {
			// Check if user is already authenticated
			const isAuthenticated = await auth0.isAuthenticated();

			if (isAuthenticated) {
				// User is logged in
				const user = await auth0.getUser();
				document.getElementById('login').style.display = 'none';
				document.getElementById('logout').style.display = 'block';
				document.getElementById('user-info').innerHTML = `
                        Logged in as: ${user.name}<br>
                        Email: ${user.email}
                    `;

				// Optional: Get access token for API calls
				const token = await auth0.getTokenSilently();
				console.log('Access Token:', token);
			} else {
				// Check for redirect from Auth0
				const query = window.location.search;
				if (query.includes('code=') && query.includes('state=')) {
					// Complete authentication after redirect
					await auth0.handleRedirectCallback();
					window.history.replaceState({}, document.title, window.location.pathname);
					handleAuthState(); // Recheck auth state
				}
			}
		} catch (error) {
			console.error('Authentication error:', error);
		}
	}

	// Initialize authentication on page load
	window.addEventListener('load', handleAuthState);
</script>
</body>
</html>